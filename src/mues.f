      SUBROUTINE MUEZ ( VALSYM , VALASY ,
     1                  SMAT   , HMAT   , NDIMRO , NDIMCO ,
     1                  IDIMRO , IDIMCO ,
     1                  INTSYM , INTASY , ISTOFF , JSTOFF ,
     4                  NOPERS       )
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,10)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,10)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW,V2VAL(10),NSVAL(10)
      INTEGER LENINT,IOSC1,IOSC3,I,J,IR,JL
      REAL*8 G,GC1,GC3,GC1113,GC3133,GC1133,GC3113
      REAL*8 SMAT(NOBAS,NOBAS,NOPERS),VALSYM(INTSYM),VALASY(INTASY),
     1       HMAT(IDIMRO,IDIMCO)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /BOOKK/ NZERSY , NZERAS , NONESY , NONEAS , NTWOSY ,
     1               NTWOAS , KZERSY , KZERAS , KONESY , KONEAS ,
     2               KTWOSY , KTWOAS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /AMPDI/ IDPMA
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      REWIND NFIL9
      DO 5000 III=1,KZERSY
      IOFFSY=(III-1)*NZERSY
5000  READ (NFIL9 ) (VALSYM(IOFFSY+L), L=1,NZERSY)
      KBDSYM=0
      IF (.NOT. SYMM) THEN
      REWIND NFIL10
      DO 5010 III=1,KZERAS
      IOFFAS=(III-1)*NZERAS
5010  READ (NFIL10) (VALASY(IOFFAS+L), L=1,NZERAS)
      KBDASY=0
      ENDIF
C
      DO 940 KP1=1,JMAXP1
C
      DO 99 JL=1,IDIMCO
      DO 99 IR=1,IDIMRO
99    HMAT(IR,JL)=0.0D+00
C
      DO 920 INDEX1=1,V2MXP1
      DO 900 INDEX2=1,V2MXP1
C
      KBDSYM=KBDSYM+1
      IOFFSY=(KBDSYM-1)*NZERSY
      IF (.NOT.SYMM) THEN
          KBDASY=KBDASY+1
          IOFFAS=(KBDASY-1)*NZERAS
      ENDIF
C
      KNDEX=0
C
      IROWOF=(INDEX1-1)*NDIMRO
      ICOLOF=(INDEX2-1)*NDIMCO
C
C  1. LEADING TERM (NOT DEPENDING ON STRETCHING COORDINATES)
C
      IF (.NOT. SYMM) THEN
      G = VALSYM(IOFFSY+59)
      DO 100 IR=1,NDIMRO
100   HMAT(IROWOF+IR,ICOLOF+IR)=HMAT(IROWOF+IR,ICOLOF+IR)
     1                       +G
      ENDIF
C
C  2. TERMS CONTAINING Y1
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+60)
      DO 120 JL=1,NDIMCO
      DO 120 IR=1,NDIMRO
120   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 3. TERMS CONTAINING Y3
C
      KNDEX=KNDEX+1
      G=-G
      IF (.NOT. SYMM) G = VALASY(IOFFAS+42)
      DO 140 JL=1,NDIMCO
      DO 140 IR=1,NDIMRO
140   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C  4. TERMS CONTAINING Y1*Y1
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+61)
      DO 160 JL=1,NDIMCO
      DO 160 IR=1,NDIMRO
160   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 5. TERMS CONTAINING Y3*Y3
C
      KNDEX=KNDEX+1
      G=-G
      IF (.NOT. SYMM) G = VALASY(IOFFAS+43)
      DO 180 JL=1,NDIMCO
      DO 180 IR=1,NDIMRO
180   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 6. TERMS CONTAINING Y1*Y3
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+62)
      DO 200 JL=1,NDIMCO
      DO 200 IR=1,NDIMRO
200   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C  7. TERMS CONTAINING Y1*Y1*Y1
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+63)
      DO 220 JL=1,NDIMCO
      DO 220 IR=1,NDIMRO
220   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 8. TERMS CONTAINING Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      G=-G
      IF (.NOT. SYMM) G = VALASY(IOFFAS+44)
      DO 240 JL=1,NDIMCO
      DO 240 IR=1,NDIMRO
240   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C  9. TERMS CONTAINING Y1*Y1*Y3
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+64)
      DO 260 JL=1,NDIMCO
      DO 260 IR=1,NDIMRO
260   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 10. TERMS CONTAINING Y1*Y3*Y3
C
      KNDEX=KNDEX+1
      G=-G
      IF (.NOT. SYMM) G = VALASY(IOFFAS+45)
      DO 280 JL=1,NDIMCO
      DO 280 IR=1,NDIMRO
280   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                   +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C  11. TERMS CONTAINING Y1*Y1*Y1*Y1
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+65)
      DO 300 JL=1,NDIMCO
      DO 300 IR=1,NDIMRO
300   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 12. TERMS CONTAINING Y3*Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      G=-G
      IF (.NOT. SYMM) G = VALASY(IOFFAS+46)
      DO 320 JL=1,NDIMCO
      DO 320 IR=1,NDIMRO
320   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C  13. TERMS CONTAINING Y1*Y1*Y1*Y3
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+66)
      DO 340 JL=1,NDIMCO
      DO 340 IR=1,NDIMRO
340   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 14. TERMS CONTAINING Y1*Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      G=-G
      IF (.NOT. SYMM) G = VALASY(IOFFAS+47)
      DO 360 JL=1,NDIMCO
      DO 360 IR=1,NDIMRO
360   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
C
C 15. TERMS CONTAINING Y1*Y1*Y3*Y3
C
      KNDEX=KNDEX+1
      G = VALSYM(IOFFSY+67)
      DO 380 JL=1,NDIMCO
      DO 380 IR=1,NDIMRO
380   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
900   CONTINUE
920   CONTINUE
      WRITE (NFIL18,REC=KP1) ((HMAT(IR,JL),IR=1,IDIMRO),JL=1,IDIMCO)
C
C*************************************************************
C
C     WRITE OUT VIBRATIONAL DIPOLE MATRIX ELEMENTS
C
C*************************************************************
C
      IF (IDPMA .NE. 0) THEN
      KVAL=KP1-1
      IF (SYMM) THEN
           WRITE (NFIL6,5580) KVAL
      ELSE
           WRITE (NFIL6,5582) KVAL
      ENDIF
      ISNT1=IDIMRO
      ISNT2=IDIMCO
      ISNT=ISNT1+ISNT2
      NCOLL=1
      NCOLU=ISNT2
      IF (NCOLU.GT.10) NCOLU=10
      NNDCO=IDIMCO/V2MXP1-1
      INDV21=0
      INSTR1=0
2700  LNDEX=0
      DO 2622 I=NCOLL,NCOLU
      LNDEX=LNDEX+1
      V2VAL(LNDEX)=INDV21
      NSVAL(LNDEX)=INSTR1
      IF (INSTR1 .EQ. NNDCO) THEN
            INDV21=INDV21+1
            INSTR1=0
      ELSE
            INSTR1=INSTR1+1
      ENDIF
2622  CONTINUE
      WRITE (NFIL6,5590) (V2VAL(I), I=1,1-NCOLL+NCOLU)
      WRITE (NFIL6,5592) (NSVAL(I), I=1,1-NCOLL+NCOLU)
      WRITE (NFIL6,5591)
      NNDRO=IDIMRO/V2MXP1-1
      INDV22=0
      INSTR2=0
      DO 2710 I=1,ISNT1
      WRITE (NFIL6,5540) INDV22,INSTR2,(HMAT(I,J), J=NCOLL,NCOLU)
      IF (INSTR2 .EQ. NNDRO) THEN
            INDV22=INDV22+1
            INSTR2=0
      ELSE
            INSTR2=INSTR2+1
      ENDIF
2710  CONTINUE
      IF (NCOLU.GE.ISNT2) GOTO 940
      NCOLL=NCOLL+10
      NCOLU=NCOLU+10
      IF (NCOLU.GT.ISNT2) NCOLU=ISNT2
      GOTO 2700
      ENDIF
940   CONTINUE
5540  FORMAT(' ',3X,I3,1X,I3,'   :',10F10.4)
5580  FORMAT(//'0',5X,12('*'),' A1-B2 (DELTA K = 0) MATRIX ELEMENTS ',
     1            'OF MUZ FOR K = ',I2,' (DEBYE) ',12('*')//)
5582  FORMAT(//'0',5X,12('*'),' A''-A'' (DELTA K = 0) MATRIX ELEMEN',
     1            'TS OF MUZ FOR K = ',I2,' (DEBYE) ',12('*')//)
5590  FORMAT('0',10X,'V2  ',10I10)
5592  FORMAT(' ',10X,'NB  ',10I10)
5591  FORMAT(' ',4X,'V2',2X,'NA'/' ',6X,108('-'))
      RETURN
      END
C
C
      SUBROUTINE MUEY ( VALSYM , VALASY , SMAT   , HMAT   ,
     1                                    NDIMRO , IDIMRO ,
     1                  INTSYM , INTASY , ISTOFF , IRECOF ,
     4                  NOPERS       )
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,10)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,10)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW,V2VAL(10),NSVAL(10)
      INTEGER LENINT,IOSC1,IOSC3,I,J,IR,JL
      REAL*8 G,GC1,GC3,GC1113,GC3133,GC1133,GC3113
      REAL*8 SMAT(NOBAS,NOBAS,NOPERS),VALSYM(INTSYM),VALASY(INTASY),
     1       HMAT(IDIMRO,IDIMRO)
C
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /BOOKK/ NZERSY , NZERAS , NONESY , NONEAS , NTWOSY ,
     1               NTWOAS , KZERSY , KZERAS , KONESY , KONEAS ,
     2               KTWOSY , KTWOAS
C
      COMMON /AMPDI/ IDPMA
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      CONCOR=PLANCK*AVOGNO*1.0E+16/(1.6D+01*PI*PI*VELLGT)
      CONYZ=CONCOR
      CONXR=CONCOR
      CONCOR=-CONCOR
      SQ2=SQRT(2.0D+00)
C
      REWIND NFIL11
      DO 5000 III=1,KONESY
      IOFFSY=(III-1)*NONESY
5000  READ (NFIL11) (VALSYM(IOFFSY+L), L=1,NONESY)
      KBDSYM=0
      IF (.NOT. SYMM) THEN
      REWIND NFIL12
      DO 5010 III=1,KONEAS
      IOFFAS=(III-1)*NONEAS
5010  READ (NFIL12) (VALASY(IOFFAS+L), L=1,NONEAS)
      KBDASY=0
      ENDIF
C
      DO 780 K1P1=1,JMAXP1
      DO 770 KDEL=-1,1,2
      K2P1=K1P1+KDEL
      IF (K2P1 .LT. 1 .OR. K2P1 .GT. JMAXP1) GOTO 770
C
      DO 93 JL=1,IDIMRO
      DO 93 IR=1,IDIMRO
93    HMAT(IR,JL)=0.0D+00
C
      DO 760 INDEX1=1,V2MXP1
      DO 750 INDEX2=1,V2MXP1
C
C
      KBDSYM=KBDSYM+1
      IOFFSY=(KBDSYM-1)*NONESY
      IF (.NOT.SYMM) THEN
          KBDASY=KBDASY+1
          IOFFAS=(KBDASY-1)*NONEAS
      ENDIF
C
      KNDEX=0
C
      IROWOF=(INDEX1-1)*NDIMRO
      ICOLOF=(INDEX2-1)*NDIMRO
C
C
C  1. LEADING TERM (NOT DEPENDING ON STRETCHING COORDINATES)
C
      G=VALSYM(IOFFSY+26)
      DO 100 IR=1,NDIMRO
100   HMAT(IROWOF+IR,ICOLOF+IR)=HMAT(IROWOF+IR,ICOLOF+IR)
     1                       +G
C
C  2. TERMS CONTAINING Y1
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+27)
      DO 120 JL=1,NDIMRO
      DO 120 IR=1,NDIMRO
120   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 3. TERMS CONTAINING Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G = VALASY(IOFFAS+23)
      DO 140 JL=1,NDIMRO
      DO 140 IR=1,NDIMRO
140   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C  4. TERMS CONTAINING Y1*Y1
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+28)
      DO 160 JL=1,NDIMRO
      DO 160 IR=1,NDIMRO
160   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 5. TERMS CONTAINING Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G = VALASY(IOFFAS+24)
      DO 180 JL=1,NDIMRO
      DO 180 IR=1,NDIMRO
180   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 6. TERMS CONTAINING Y1*Y3
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+29)
      DO 200 JL=1,NDIMRO
      DO 200 IR=1,NDIMRO
200   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C  7. TERMS CONTAINING Y1*Y1*Y1
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+30)
      DO 220 JL=1,NDIMRO
      DO 220 IR=1,NDIMRO
220   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 8. TERMS CONTAINING Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G = VALASY(IOFFAS+25)
      DO 240 JL=1,NDIMRO
      DO 240 IR=1,NDIMRO
240   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C  9. TERMS CONTAINING Y1*Y1*Y3
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+31)
      DO 260 JL=1,NDIMRO
      DO 260 IR=1,NDIMRO
260   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 10. TERMS CONTAINING Y1*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G = VALASY(IOFFAS+26)
      DO 280 JL=1,NDIMRO
      DO 280 IR=1,NDIMRO
280   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C  11. TERMS CONTAINING Y1*Y1*Y1*Y1
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+32)
      DO 300 JL=1,NDIMRO
      DO 300 IR=1,NDIMRO
300   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 12. TERMS CONTAINING Y3*Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G = VALASY(IOFFAS+27)
      DO 320 JL=1,NDIMRO
      DO 320 IR=1,NDIMRO
320   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C  13. TERMS CONTAINING Y1*Y1*Y1*Y3
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+33)
      DO 340 JL=1,NDIMRO
      DO 340 IR=1,NDIMRO
340   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 14. TERMS CONTAINING Y1*Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G = VALASY(IOFFAS+28)
      DO 360 JL=1,NDIMRO
      DO 360 IR=1,NDIMRO
360   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
C
C 15. TERMS CONTAINING Y1*Y1*Y3*Y3
C
      KNDEX=KNDEX+1
       G = VALSYM(IOFFSY+34)
      DO 380 JL=1,NDIMRO
      DO 380 IR=1,NDIMRO
380   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                       +G*SMAT(ISTOFF+IR,ISTOFF+JL,KNDEX)
750   CONTINUE
760   CONTINUE
      IREC=IRECOF+2*(K1P1-1)+(KDEL+1)/2+1
      WRITE (NFIL19,REC=IREC) ((HMAT(IR,JL),IR=1,IDIMRO),JL=1,IDIMRO)
C
C*************************************************************
C
C     WRITE OUT VIBRATIONAL DIPOLE MATRIX ELEMENTS
C
C*************************************************************
C
      IF (KDEL .EQ. -1) GOTO 770
C
      IF (IDPMA .NE. 0) THEN
      IF (IRECOF .EQ. 0) THEN
      KVAL=K1P1-1
      IF (SYMM) THEN
           WRITE (NFIL6,5500) KDEL,KVAL
      ELSE
           WRITE (NFIL6,5502) KDEL,KVAL
      ENDIF
      ISNT=IDIMRO
      NCOLL=1
      NCOLU=ISNT
      IF (NCOLU.GT.10) NCOLU=10
      NNDEX=IDIMRO/V2MXP1-1
      INDV21=0
      INSTR1=0
2620  NUP=NCOLU
      IF (NUP.GT.ISNT) NUP=ISNT
      LNDEX=0
      DO 2622 I=NCOLL,NUP
      LNDEX=LNDEX+1
      V2VAL(LNDEX)=INDV21
      NSVAL(LNDEX)=INSTR1
      IF (INSTR1 .EQ. NNDEX) THEN
            INDV21=INDV21+1
            INSTR1=0
      ELSE
            INSTR1=INSTR1+1
      ENDIF
2622  CONTINUE
      WRITE (NFIL6,5520) (V2VAL(I), I=1,1-NCOLL+NUP)
      WRITE (NFIL6,5522) (NSVAL(I), I=1,1-NCOLL+NUP)
      WRITE (NFIL6,5521)
      INDV22=0
      INSTR2=0
      DO 2630 I=1,ISNT
      NUP=NCOLU
      WRITE (NFIL6,5540) INDV22,INSTR2,(HMAT(I,J), J=NCOLL,NUP)
      IF (INSTR2 .EQ. NNDEX) THEN
            INDV22=INDV22+1
            INSTR2=0
      ELSE
            INSTR2=INSTR2+1
      ENDIF
2630  CONTINUE
      IF (NCOLU.GE.ISNT) GOTO 2640
      NCOLL=NCOLL+10
      NCOLU=NCOLU+10
      IF (NCOLU.GT.ISNT) NCOLU=ISNT
      GOTO 2620
2640  CONTINUE
      ELSE
      KVAL=K1P1-1
      WRITE (NFIL6,5560) KDEL,KVAL
      ISNT=IDIMRO
      NCOLL=1
      NCOLU=ISNT
      IF (NCOLU.GT.10) NCOLU=10
      NNDEX=IDIMRO/V2MXP1-1
      INDV21=0
      INSTR1=0
2660  NUP=NCOLU
      IF (NUP.GT.ISNT) NUP=ISNT
      LNDEX=0
      DO 2662 I=NCOLL,NUP
      LNDEX=LNDEX+1
      V2VAL(LNDEX)=INDV21
      NSVAL(LNDEX)=INSTR1
      IF (INSTR1 .EQ. NNDEX) THEN
            INDV21=INDV21+1
            INSTR1=0
      ELSE
            INSTR1=INSTR1+1
      ENDIF
2662  CONTINUE
      WRITE (NFIL6,5570) (V2VAL(I), I=1,1-NCOLL+NUP)
      WRITE (NFIL6,5572) (NSVAL(I), I=1,1-NCOLL+NUP)
      WRITE (NFIL6,5571)
      INDV22=0
      INSTR2=0
      DO 2670 I=1,ISNT
      NUP=NCOLU
      WRITE (NFIL6,5540) INDV22,INSTR2,(HMAT(I,J), J=NCOLL,NUP)
      IF (INSTR2 .EQ. NNDEX) THEN
            INDV22=INDV22+1
            INSTR2=0
      ELSE
            INSTR2=INSTR2+1
      ENDIF
2670  CONTINUE
      IF (NCOLU.GE.ISNT) GOTO 2680
      NCOLL=NCOLL+10
      NCOLU=NCOLU+10
      IF (NCOLU.GT.ISNT) NCOLU=ISNT
      GOTO 2660
2680  CONTINUE
      ENDIF
      ENDIF
770   CONTINUE
780   CONTINUE
      RETURN
5500  FORMAT(// '0',5X,12('*'),' A1-A1 (DELTA K = ',I2,
     1 ' MATRIX ELEMENTS ',
     1 'OF MUY FOR K = ',I2,' (DEBYE) ',12('*')//)
5502  FORMAT(// '0',5X,12('*'),' A''-A'' (DELTA K = ',I2,
     1 ' MATRIX ELEMENTS ',
     1 'OF MUY FOR K = ',I2,' (DEBYE) ',12('*')//)
5520  FORMAT('0',10X,'V2  ',10I10)
5522  FORMAT(' ',10X,'NA  ',10I10)
5521  FORMAT(' ',4X,'V2',2X,'NA'/' ',6X,108('-'))
5540  FORMAT(' ',3X,I3,1X,I3,'   :',10F10.4)
5560  FORMAT(//'0',5X,12('*'),' B2-B2 (DELTA K = ',I2,
     1 ' MATRIX ELEMENTS ',
     1 'OF MUY FOR K = ',I2,' (DEBYE) ',12('*')//)
5570  FORMAT('0',10X,'V2  ',10I10)
5572  FORMAT(' ',10X,'NB  ',10I10)
5571  FORMAT(' ',4X,'V2',2X,'NB'/' ',6X,108('-'))
      END
C
C
      SUBROUTINE CINTNS ( JU     , LRODIM , IDMRZ  , IDMCZ  , IDMRY  ,
     .                    CLO    , CUP    , ZMU    , YMU    , NTRANS ,
     .                    FRQLO  , FRQHI  , XINLIM ,
     .                    V2A , NVA , IABA , V2B , NVB , IABB ,
     .                    TRTLIM , ABSINT , GNS , ISOTOP ,
     .                    ENGLIM )
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,GNS(2,2,10),
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,10)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT , V2A , V2B , V2T
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,10)
C
      INTEGER TAUL,TAUU,V2VALU,V2VALL
      REAL*8   CLO(LRODIM),CUP(LRODIM),ZMU(IDMRZ,IDMCZ),YMU(IDMRY,IDMRY)
C
      LOGICAL ABSYM,BASYM,SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER LENINT,IOSC1,IOSC3,I,J,IR,JL
      REAL*8 G,GC1,GC3,GC1113,GC3133,GC1133,GC3113
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /AMPDI/ IDPMA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      SQ2=SQRT(2.0D+00)
C
      DO 9000 JD=0,1
      JL=JU-JD
      IF (JL .LT. 0) GOTO 9000
C
      IF ((.NOT.SYMM) .AND. JU .EQ. JL) THEN
          MAXTAU=0
      ELSE
          MAXTAU=1
      ENDIF
C
      DO 8990 TAUU=0,MAXTAU
      TAUL=MOD(TAUU+1,2)
C
      IF ((.NOT.SYMM) .OR. JU .EQ. JL) THEN
          IEOMAX=0
      ELSE
          IEOMAX=1
      ENDIF
C
      DO 8980 IEOU=0,IEOMAX
      IF (SYMM) THEN
           IEOL=MOD(IEOU+1,2)
      ELSE
           IEOL=IEOU
      ENDIF
C
      JLP1=JL+1
      IF (MOD(JL,2) .EQ. 0) THEN
          IROTEL=JL/2+1
          IROTOL=JL/2
      ELSE
          IROTEL=(JL+1)/2
          IROTOL=IROTEL
      ENDIF
      IF (MOD(JL+TAUL,2) .NE. 0) IROTEL=IROTEL-1
      JUP1=JU+1
      IF (MOD(JU,2) .EQ. 0) THEN
          IROTEU=JU/2+1
          IROTOU=JU/2
      ELSE
          IROTEU=(JU+1)/2
          IROTOU=IROTEU
      ENDIF
      IF (MOD(JU+TAUU,2) .NE. 0) IROTEU=IROTEU-1
C
      IF (SYMM) THEN
           IF (IEOU .EQ. 0) THEN
                ICEVEU=LSTYPA(1)
                ICODDU=LSTYPA(2)
                IDIMU=(IROTEU*LSTYPA(1)+IROTOU*LSTYPA(2))*V2MXP1
                ICEVEL=LSTYPA(2)
                ICODDL=LSTYPA(1)
                IDIML=(IROTEL*LSTYPA(2)+IROTOL*LSTYPA(1))*V2MXP1
           ELSE
                ICEVEU=LSTYPA(2)
                ICODDU=LSTYPA(1)
                IDIMU=(IROTEU*LSTYPA(2)+IROTOU*LSTYPA(1))*V2MXP1
                ICEVEL=LSTYPA(1)
                ICODDL=LSTYPA(2)
                IDIML=(IROTEL*LSTYPA(1)+IROTOL*LSTYPA(2))*V2MXP1
           ENDIF
      ELSE
           ICEVEU=LSTYPA(1)
           ICODDU=LSTYPA(1)
           IDIMU=(IROTEU+IROTOU)*LSTYPA(1)*V2MXP1
           ICEVEL=LSTYPA(1)
           ICODDL=LSTYPA(1)
           IDIML=(IROTEL+IROTOL)*LSTYPA(1)*V2MXP1
      ENDIF
C
      DO 8970 LNDXU=1,IDIMU
C
      IRECU=(4*MOD(JU,2)+2*TAUU+IEOU)*LRODIM+LNDXU
      READ (NFIL17,REC=IRECU) EU,(CUP(JJ),JJ=1,IDIMU)
C
C     DETERMINE THE BASISFUNCTION WITH WHICH THIS EIGENFUNCTION HAS
C     MAXIMUM OVERLAP
C
      MAXC=IDAMAX(IDIMU,CUP(1),1)
C
      IDEVEU=ICEVEU*V2MXP1
      IDODDU=ICODDU*V2MXP1
      IF (MAXC .LE. IROTEU*IDEVEU) THEN
          II=MOD(MAXC-1,IDEVEU)
          KVALU=2*(MAXC-II-1)/IDEVEU
          IF (MOD(JU+TAUU,2) .NE. 0) KVALU=KVALU+2
          NVALU=MOD(II,ICEVEU)
          V2VALU=(II-NVALU)/ICEVEU
          IABU=1
          IF (IEOU .EQ. 1 .AND. SYMM) IABU=2
      ELSE
          MAXC=MAXC-IROTEU*IDEVEU
          II=MOD(MAXC-1,IDODDU)
          KVALU=2*(MAXC-II-1)/IDODDU+1
          NVALU=MOD(II,ICODDU)
          V2VALU=(II-NVALU)/ICODDU
          IABU=1
          IF (IEOU .EQ. 0 .AND. SYMM) IABU=2
      ENDIF
C
      IF (V2A .LT. 0 .OR. V2B .LT. 0) GOTO 8959
C
      IF ((V2VALU .NE. V2A .OR. NVALU .NE. NVA .OR. IABU .NE. IABA)
     ..AND.(V2VALU .NE. V2B .OR. NVALU .NE. NVB .OR. IABU .NE. IABB))
     . GOTO 8970
      IF (V2VALU .EQ. V2A .AND. NVALU .EQ. NVA
     . .AND. IABU .EQ. IABA) THEN
            V2T=V2B
            NVT=NVB
            IABT=IABB
      ELSE
            V2T=V2A
            NVT=NVA
            IABT=IABA
      ENDIF
C
8959  CONTINUE
C
      DO 8960 LNDXL=1,IDIML
C
      IRECL=(4*MOD(JL,2)+2*TAUL+IEOL)*LRODIM+LNDXL
      READ (NFIL17,REC=IRECL) EL,(CLO(JJ),JJ=1,IDIML)
C
      IF (ABS(EU-EL) .LT. FRQLO .OR. ABS(EU-EL) .GT. FRQHI)
     .                   GOTO 8960
      IF (EU .GE. EL .AND. EL .GT. ENGLIM) GOTO 8960
      IF (EL .GT. EU .AND. EU .GT. ENGLIM) GOTO 8960
C
C
C     DETERMINE THE BASISFUNCTION WITH WHICH THIS EIGENFUNCTION HAS
C     MAXIMUM OVERLAP
C
      MAXC=IDAMAX(IDIML,CLO(1),1)
C
      IDEVEL=ICEVEL*V2MXP1
      IDODDL=ICODDL*V2MXP1
      IF (MAXC .LE. IROTEL*IDEVEL) THEN
          II=MOD(MAXC-1,IDEVEL)
          KVALL=2*(MAXC-II-1)/IDEVEL
          IF (MOD(JL+TAUL,2) .NE. 0) KVALL=KVALL+2
          NVALL=MOD(II,ICEVEL)
          V2VALL=(II-NVALL)/ICEVEL
          IABL=1
          IF (IEOL .EQ. 1 .AND. SYMM) IABL=2
      ELSE
          MAXC=MAXC-IROTEL*IDEVEL
          II=MOD(MAXC-1,IDODDL)
          KVALL=2*(MAXC-II-1)/IDODDL+1
          NVALL=MOD(II,ICODDL)
          V2VALL=(II-NVALL)/ICODDL
          IABL=1
          IF (IEOL .EQ. 0 .AND. SYMM) IABL=2
      ENDIF
C
      IF (V2A .LT. 0 .OR. V2B .LT. 0) GOTO 399
C
      IF (V2VALL .NE. V2T .OR. NVALL .NE. NVT
     . .OR. IABL .NE. IABT) GOTO 8960
C
399   JEND=MIN(JLP1,JUP1)
C
C     SUM UP CONTRIBUTIONS WITH DELTA K = 0
C
      TRMOM0=0.0D+00
C
      DO 400 KP1=1,JEND
C
      IF (KP1 .EQ. 1 .AND. (MOD(JU+TAUU,2) .NE. 0
     .    .OR. MOD(JL+TAUL,2) .NE. 0)) GOTO 400
C
      IF (MOD(KP1,2) .NE. 0) THEN
          INDKL=(KP1-1)/2
          IF (MOD(JL+TAUL,2) .NE. 0) INDKL=INDKL-1
          INDKU=(KP1-1)/2
          IF (MOD(JU+TAUU,2) .NE. 0) INDKU=INDKU-1
      ELSE
          INDKL=(KP1-2)/2
          INDKU=(KP1-2)/2
      ENDIF
C
      ABSYM=.FALSE.
C
      IF (MOD(KP1,2) .EQ. 0) THEN
           IF (.NOT. SYMM) THEN
                 ABSYM=.TRUE.
                 KOFSL=IROTEL*V2MXP1*LSTYPA(1)
                 KOFSU=IROTEU*V2MXP1*LSTYPA(1)
                 NDIMSL=LSTYPA(1)
                 NDIMSU=LSTYPA(1)
           ELSE
                 IF (IEOL .EQ. 0) THEN
                      KOFSL=IROTEL*V2MXP1*LSTYPA(1)
                      KOFSU=IROTEU*V2MXP1*LSTYPA(2)
                      NDIMSL=LSTYPA(2)
                      NDIMSU=LSTYPA(1)
                 ELSE
                      ABSYM=.TRUE.
                      KOFSL=IROTEL*V2MXP1*LSTYPA(2)
                      KOFSU=IROTEU*V2MXP1*LSTYPA(1)
                      NDIMSL=LSTYPA(1)
                      NDIMSU=LSTYPA(2)
                 ENDIF
           ENDIF
      ELSE
           KOFSL=0
           KOFSU=0
           IF (.NOT. SYMM) THEN
                 ABSYM=.TRUE.
                 NDIMSL=LSTYPA(1)
                 NDIMSU=LSTYPA(1)
           ELSE
                 IF (IEOL .EQ. 0) THEN
                      ABSYM=.TRUE.
                      NDIMSL=LSTYPA(1)
                      NDIMSU=LSTYPA(2)
                 ELSE
                      NDIMSL=LSTYPA(2)
                      NDIMSU=LSTYPA(1)
                 ENDIF
           ENDIF
      ENDIF
C
      IF (SYMM) THEN
           LDIMR=V2MXP1*LSTYPA(1)
           LDIMC=V2MXP1*LSTYPA(2)
           READ (NFIL18,REC=KP1) ((ZMU(IR,JQ), IR=1,LDIMR),
     .                                         JQ=1,LDIMC)
      ELSE
           LDIMR=V2MXP1*LSTYPA(1)
           READ (NFIL18,REC=KP1) ((ZMU(IR,JQ), IR=1,LDIMR),
     .                                         JQ=1,LDIMR)
      ENDIF
C
      DO 300  INDEXL=1,V2MXP1
      DO 300  INDEXU=1,V2MXP1
C
      ILOOFF=KOFSL+INDKL*V2MXP1*NDIMSL+(INDEXL-1)*NDIMSL
      IUPOFF=KOFSU+INDKU*V2MXP1*NDIMSU+(INDEXU-1)*NDIMSU
      IROWOL=(INDEXL-1)*NDIMSL
      ICOLOU=(INDEXU-1)*NDIMSU
C
      SUM0=0.0D+00
C
C
      IF (ABSYM) THEN
           DO 200 JNDEXU=1,NDIMSU
           DO 200 JNDEXL=1,NDIMSL
200        SUM0=SUM0+CLO(ILOOFF+JNDEXL)*CUP(IUPOFF+JNDEXU)*
     1               ZMU(IROWOL+JNDEXL,ICOLOU+JNDEXU)
      ELSE
           DO 210 JNDEXL=1,NDIMSL
           DO 210 JNDEXU=1,NDIMSU
210        SUM0=SUM0+CLO(ILOOFF+JNDEXL)*CUP(IUPOFF+JNDEXU)*
     1               ZMU(ICOLOU+JNDEXU,IROWOL+JNDEXL)
      ENDIF
C
C

      KV=KP1-1
      TRMOM0=TRMOM0 + SUM0*CLG(JL,JD,KV,0)
C
300   CONTINUE
400   CONTINUE
C
C     SUM UP CONTRIBUTIONS WITH DELTA K = 1
C
      TRMOM1=0.0D+00
C
      DO 800 KLP1=1,JLP1
      IF (KLP1 .EQ. 1 .AND. MOD(JL+TAUL,2) .NE. 0) GOTO 800
C
      IF (MOD(KLP1,2) .NE. 0) THEN
          INDKL=(KLP1-1)/2
          IF (MOD(JL+TAUL,2) .NE. 0) INDKL=INDKL-1
      ELSE
          INDKL=(KLP1-2)/2
      ENDIF
C
      DO 700  KD=-1,1,2
C
      KUP1=KLP1+KD
      IF (KUP1 .LT. 1 .OR. KUP1 .GT. JUP1) GOTO 700
      IF (KUP1 .EQ. 1 .AND. MOD(JU+TAUU,2) .NE. 0) GOTO 700
C
      IF (MOD(KUP1,2) .NE. 0) THEN
          INDKU=(KUP1-1)/2
          IF (MOD(JU+TAUU,2) .NE. 0) INDKU=INDKU-1
      ELSE
          INDKU=(KUP1-2)/2
      ENDIF
C
      BASYM=.FALSE.
C
      IF (MOD(KLP1,2) .EQ. 0) THEN
           IF (.NOT. SYMM) THEN
                 BASYM=.TRUE.
                 KOFSL=IROTEL*V2MXP1*LSTYPA(1)
                 KOFSU=0
                 NDIMSL=LSTYPA(1)
                 NDIMSU=LSTYPA(1)
           ELSE
                 IF (IEOL .EQ. 0) THEN
                      KOFSL=IROTEL*V2MXP1*LSTYPA(1)
                      KOFSU=0
                      NDIMSL=LSTYPA(2)
                      NDIMSU=LSTYPA(2)
                 ELSE
                      BASYM=.TRUE.
                      KOFSL=IROTEL*V2MXP1*LSTYPA(2)
                      KOFSU=0
                      NDIMSL=LSTYPA(1)
                      NDIMSU=LSTYPA(1)
                 ENDIF
           ENDIF
      ELSE
           IF (.NOT. SYMM) THEN
                 BASYM=.TRUE.
                 KOFSL=0
                 KOFSU=IROTEU*V2MXP1*LSTYPA(1)
                 NDIMSL=LSTYPA(1)
                 NDIMSU=LSTYPA(1)
           ELSE
                 IF (IEOL .EQ. 0) THEN
                      BASYM=.TRUE.
                      KOFSL=0
                      KOFSU=IROTEU*V2MXP1*LSTYPA(2)
                      NDIMSL=LSTYPA(1)
                      NDIMSU=LSTYPA(1)
                 ELSE
                      KOFSL=0
                      KOFSU=IROTEU*V2MXP1*LSTYPA(1)
                      NDIMSL=LSTYPA(2)
                      NDIMSU=LSTYPA(2)
                 ENDIF
           ENDIF
      ENDIF
C
      IF (BASYM) THEN
            IREC=2*(KLP1-1)+(KD+1)/2+1
      ELSE
            IREC=2*(JMAX+KLP1)+(KD+1)/2+1
      ENDIF
C
      LDIMR=V2MXP1*NDIMSL
      READ (NFIL19,REC=IREC) ((YMU(IR,JQ), IR=1,LDIMR),
     .                                     JQ=1,LDIMR)
C
      DO 600  INDEXL=1,V2MXP1
      DO 600  INDEXU=1,V2MXP1
C
      ILOOFF=KOFSL+INDKL*V2MXP1*NDIMSL+(INDEXL-1)*NDIMSL
      IUPOFF=KOFSU+INDKU*V2MXP1*NDIMSU+(INDEXU-1)*NDIMSU
      ICOLOL=(INDEXL-1)*NDIMSL
      IROWOU=(INDEXU-1)*NDIMSU
C
      SUM1=0.0D+00
      DO 502 JNDEXU=1,NDIMSU
      SUM11=0.0D+00
      DO 500 JNDEXL=1,NDIMSL
500   SUM11=SUM11+CLO(ILOOFF+JNDEXL)*
     1            YMU(ICOLOL+JNDEXL,IROWOU+JNDEXU)
502   SUM1=SUM1+SUM11*CUP(IUPOFF+JNDEXU)
C
      IF (KLP1 .EQ. 1 .OR. KUP1 .EQ. 1) SUM1=SQ2*SUM1
C
      KV=KLP1-1
      TRMOM1=TRMOM1 + SUM1*CLG(JL,JD,KV,KD)*FLOAT(KD)/SQ2
C
600   CONTINUE
700   CONTINUE
800   CONTINUE
C
      TRMOM=(2.0D+00*FLOAT(JL)+1.0D+00)*(TRMOM0-TRMOM1)**2
      IF (TRMOM .LT. XINLIM) GOTO 8960
C
      XPACKU=1.0D+00*IABU+1.0D+01*V2VALU+1.0D+03*NVALU
     .      +1.0D+05*KVALU+1.0D+07*IEOU+1.0D+08*TAUU
     .      +1.0D+09*JU
      XPACKL=1.0D+00*IABL+1.0D+01*V2VALL+1.0D+03*NVALL
     .      +1.0D+05*KVALL+1.0D+07*IEOL+1.0D+08*TAUL
     .      +1.0D+09*JL
      ELOW=EL
      FREQ=EU-EL
C
      IF (FREQ .LT. 0.0D+00) THEN
          XDUMMY=XPACKL
          XPACKL=XPACKU
          XPACKU=XDUMMY
          ELOW=EU
          FREQ=-FREQ
      ENDIF
C
      IF (SYMM) THEN
      TRINT=ABSINT*FREQ*GNS(TAUL+1,IEOL+1,ISOTOP)*TRMOM
      ELSE
      TRINT=ABSINT*FREQ*GNS(1,1,ISOTOP)*TRMOM
      ENDIF
      IF (TRINT .LT. TRTLIM) GOTO 8960
C
C
      NTRANS=NTRANS+1
      WRITE (NFIL20) XPACKL,XPACKU,ELOW,FREQ,TRMOM,TRINT
C
8960  CONTINUE
8970  CONTINUE
8980  CONTINUE
8990  CONTINUE
9000  CONTINUE
      RETURN
      END
